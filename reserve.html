<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserve Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Reserve Room</h1>
        <div id="message" class="message"></div>
        <label for="room-select">Select Room:</label>
        <select id="room-select">
            <!-- Rooms will be populated here -->
        </select>

        <label for="start-time">Start Time:</label>
        <input type="time" id="start-time" required>

        <label for="end-time">End Time:</label>
        <input type="time" id="end-time" required>

        <button onclick="reserveRoom()">Reserve</button>
        <button onclick="location.href='index.html'">Back</button>
    </div>

    <script>
        // Display all rooms in the dropdown
        function populateRooms() {
            const roomSelect = document.getElementById('room-select');
            const rooms = JSON.parse(localStorage.getItem('rooms')) || [];

            roomSelect.innerHTML = ''; // Clear dropdown
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.name;
                option.textContent = room.name;
                roomSelect.appendChild(option);
            });
        }

        function reserveRoom() {
            const roomName = document.getElementById('room-select').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const messageElement = document.getElementById('message');

            if (!roomName || !startTime || !endTime) {
                messageElement.textContent = 'Please fill in all fields.';
                return;
            }

            let reservedRooms = JSON.parse(localStorage.getItem('reservedRooms')) || [];

            // Check if the room is already reserved for the selected time
            const isConflict = reservedRooms.some(room => 
                room.name === roomName && 
                ((startTime >= room.startTime && startTime < room.endTime) || 
                 (endTime > room.startTime && endTime <= room.endTime) ||
                 (startTime <= room.startTime && endTime >= room.endTime))
            );

            if (isConflict) {
                messageElement.textContent = `Room "${roomName}" is already reserved during that time.`;
            } else {
                const reservationCode = Math.random().toString(36).substr(2, 9).toUpperCase(); // Generate a random code
                reservedRooms.push({
                    name: roomName,
                    startTime: startTime,
                    endTime: endTime,
                    reservationCode: reservationCode
                });
                localStorage.setItem('reservedRooms', JSON.stringify(reservedRooms));
                messageElement.textContent = `Room reserved successfully! Your reservation code is: ${reservationCode}`;
            }
        }

        document.addEventListener('DOMContentLoaded', populateRooms);
    </script>
</body>
</html>
